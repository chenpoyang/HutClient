cscope 15 $HOME/QT/HutClient               0000045003
	@controlpanel.cpp

1 
	~"cÚŒŞ·Ãl.h
"

2 
	~"ui_cÚŒŞ·Ãl.h
"

3 
	#MIN_CERTIFICATE
 0

	)

4 
	#MAX_CERTIFICATE
 1000

	)

6 
	gCÚŒŞPª–
::
	$CÚŒŞPª–
(
QWidg‘
 *
·»Á
) :

7 
	`QWidg‘
(
·»Á
),

8 
	`ui
(
Ãw
 
Ui
::
CÚŒŞPª–
)

10 
ui
->
	`£tupUi
(
this
);

11 
	`š™CÚÃùiÚ
();

12 
ui
->
addStuBŠ
->
	`£tShÜtcut
(
	`QKeySequ’û
(
	`Œ
("ALT+A")));

13 
ui
->
addStuBŠ
->
	`£tToŞT
(
	`Œ
("ALT+A"));

14 
ui
->
û¹if›dSpšBox
->
	`£tRªge
(
MIN_CERTIFICATE
, 
MAX_CERTIFICATE
);

15 
ui
->
g¿du©eTy³Cmb
->
	`addI‹m
(
	`Œ
("±¾¿ÆÉú"));

16 
ui
->
g¿du©eTy³Cmb
->
	`addI‹m
(
	`Œ
("×¨¿ÆÉú"));

17 
ui
->
sÜtRuComboBox
->
	`addI‹m
(
	`Œ
("Ö¤Êé±àºÅ"));

18 
ui
->
b©chC”tif›dBŠ
->
	`£tEÇbËd
(
çl£
);

19 
	}
}

22 
	gCÚŒŞPª–
::
	$£tCŞËge
(
QSŒšg
 
¡r
)

24 
this
->
cŞËge
 = 
¡r
;

25 
	}
}

27 
	gCÚŒŞPª–
::
	$£tMajÜ
(
QSŒšg
 
¡r
)

29 
this
->
majÜ
 = 
¡r
;

30 
	}
}

32 
	gCÚŒŞPª–
::
	$£tOrd”Ru
(
QSŒšg
 
¡r
)

34 
this
->
Üd”Ru
 = 
¡r
;

35 
	}
}

37 
	gCÚŒŞPª–
::
	$£tStuName
(
QSŒšg
 
¡r
)

39 
this
->
¡uName
 = 
¡r
;

40 
	}
}

42 
	gCÚŒŞPª–
::
	$£tStuId
(
QSŒšg
 
¡r
)

44 
this
->
¡uId
 = 
¡r
;

45 
	}
}

48 
	gCÚŒŞPª–
::
	$ÏunchS’dCŞËge
(
QSŒšg
 
cŞËge
)

50 
em™
 
	`£ndCŞËge
(
cŞËge
);

51 
	}
}

54 
	gCÚŒŞPª–
::
	$£tCŞËgeComboBox
(
QSŒšgLi¡
 &
¡rLi¡
)

56 
ui
->
cŞËgeComboBox
->
	`ş—r
();

57 
ui
->
cŞËgeComboBox
->
	`addI‹ms
(
¡rLi¡
);

58 
	}
}

61 
	gCÚŒŞPª–
::
	$£tCÏssComboBox
(
QSŒšgLi¡
 &
¡rLi¡
)

63 
ui
->
şassComboBox
->
	`ş—r
();

64 
ui
->
şassComboBox
->
	`addI‹ms
(
¡rLi¡
);

65 
	}
}

68 
	gCÚŒŞPª–
::
	$ÏunchB©chC”tifiÿ‹
()

70 
QSŒšgLi¡
 
¡rLi¡
;

71 
QSŒšg
 
¡r
;

72 
sum
, 
šdex
;

74 
¡rLi¡
 << 
ui
->
g¿du©eTy³Cmb
->
	`cu¼’tText
();

75 
sum
 = 
ui
->
û¹if›dSpšBox
->
	`v®ue
();

76 
¡r
 = "";

77 ià(
sum
 == 0)

79 
¡r
 = '0' + str;

81 
sum
)

83 
šdex
 = 
sum
 % 10;

84 
sum
 /= 10;

85 
¡r
 = (
šdex
 + '0') + str;

87 
¡rLi¡
 << 
¡r
;

89 
	`qDebug
() << "sendBatchCertificate(strList)";

90 
em™
 
	`£ndB©chC”tifiÿ‹
(
¡rLi¡
);

91 
	}
}

94 
	gCÚŒŞPª–
::
	$ÏunchQu”y
()

96 
QSŒšgLi¡
 
¡rLi¡
;

98 
¡rLi¡
 << 
cŞËge
;

99 
¡rLi¡
 << 
majÜ
;

100 
¡rLi¡
 << 
Üd”Ru
;

101 
¡rLi¡
 << 
¡uName
;

102 
¡rLi¡
 << 
¡uId
;

104 
	`qDebug
() << "sendQueryData(strList)";

105 
em™
 
	`£ndQu”yD©a
(
¡rLi¡
);

106 
	}
}

109 
	gCÚŒŞPª–
::
	$ÏunchR—dy
()

111 
em™
 
	`»adyToSave
();

112 
	}
}

114 
	gCÚŒŞPª–
::
	$š™CÚÃùiÚ
()

117 
	`cÚÃù
(
ui
->
addStuBŠ
, 
	`SIGNAL
(
	`şicked
()),

118 
this
, 
	`SLOT
(
	`ÏunchAddStu
()));

120 
	`cÚÃù
(
ui
->
impBŠ
, 
	`SIGNAL
(
	`şicked
()),

121 
this
, 
	`SLOT
(
	`£ndImpÜtSigÇl
()));

123 
	`cÚÃù
(
ui
->
expBŠ
, 
	`SIGNAL
(
	`şicked
()),

124 
this
, 
	`SLOT
(
	`£ndExpÜtSigÇl
()));

126 
	`cÚÃù
(
ui
->
§veBŠ
, 
	`SIGNAL
(
	`şicked
()),

127 
this
, 
	`SLOT
(
	`ÏunchR—dy
()));

130 
	`cÚÃù
(
ui
->
qu”yBŠ
, 
	`SIGNAL
(
	`şicked
()),

131 
this
, 
	`SLOT
(
	`ÏunchQu”y
()));

134 
	`cÚÃù
(
ui
->
b©chC”tif›dBŠ
, 
	`SIGNAL
(
	`şicked
()),

135 
this
, 
	`SLOT
(
	`ÏunchB©chC”tifiÿ‹
()));

138 
	`cÚÃù
(
ui
->
cŞËgeComboBox
, 
	`SIGNAL
(
	`cu¼’tIndexChªged
(
QSŒšg
)),

139 
this
, 
	`SLOT
(
	`ÏunchS’dCŞËge
(
QSŒšg
)));

142 
	`cÚÃù
(
ui
->
cŞËgeComboBox
, 
	`SIGNAL
(
	`cu¼’tIndexChªged
(
QSŒšg
)),

143 
this
, 
	`SLOT
(
	`£tCŞËge
(
QSŒšg
)));

144 
	`cÚÃù
(
ui
->
şassComboBox
, 
	`SIGNAL
(
	`cu¼’tIndexChªged
(
QSŒšg
)),

145 
this
, 
	`SLOT
(
	`£tMajÜ
(
QSŒšg
)));

146 
	`cÚÃù
(
ui
->
sÜtRuComboBox
, 
	`SIGNAL
(
	`cu¼’tIndexChªged
(
QSŒšg
)),

147 
this
, 
	`SLOT
(
	`£tOrd”Ru
(
QSŒšg
)));

148 
	`cÚÃù
(
ui
->
¡uNameLšeEd™
, 
	`SIGNAL
(
	`‹xtChªged
(
QSŒšg
)),

149 
this
, 
	`SLOT
(
	`£tStuName
(
QSŒšg
)));

150 
	`cÚÃù
(
ui
->
¡uIdLšeEd™
, 
	`SIGNAL
(
	`‹xtChªged
(
QSŒšg
)),

151 
this
, 
	`SLOT
(
	`£tStuId
(
QSŒšg
)));

152 
	}
}

154 
	gCÚŒŞPª–
::
	$£ndImpÜtSigÇl
()

156 
em™
 
this
->
	`impÜtD©aToTabË
();

157 
	}
}

159 
	gCÚŒŞPª–
::
	$£ndExpÜtSigÇl
()

161 
em™
 
this
->
	`expÜtD©aToLoÿl
();

162 
	}
}

164 
	gCÚŒŞPª–
::
	$ÏunchAddStu
()

166 
em™
 
	`ÚAddStuClicked
();

167 
	}
}

169 
	gCÚŒŞPª–
::
	$keyP»ssEv’t
(
QKeyEv’t
 *
ev’t
)

171 
	`qDebug
(è<< 
ev’t
->
	`key
();

172 
	}
}

174 
	gCÚŒŞPª–
::~
	$CÚŒŞPª–
()

176 
d–‘e
 
ui
;

177 
	}
}

	@controlpanel.h

1 #iâdeà
CONTROLPANEL_H


2 
	#CONTROLPANEL_H


	)

4 
	~<QWidg‘
>

5 
	~<QKeyEv’t
>

6 
	~<QDebug
>

7 
	~<QSqlD©aba£
>

8 
	~<QSqlQu”y
>

9 
	~"d©awidg‘.h
"

11 
Çme¥aû
 
	gUi
 {

12 
şass
 
	gCÚŒŞPª–
;

15 şas 
	cCÚŒŞPª–
 : 
public
 
QWidg‘


17 
Q_OBJECT


19 
public
:

20 
ex¶ic™
 
CÚŒŞPª–
(
QWidg‘
 *
·»Á
 = 0);

21 ~
CÚŒŞPª–
();

22 
š™CÚÃùiÚ
();

24 
	m´Ùeùed
:

25 
vœtu®
 
keyP»ssEv’t
(
QKeyEv’t
 *
ev’t
);

27 
	msigÇls
:

28 
ÚAddStuClicked
();

29 
impÜtD©aToTabË
();

30 
expÜtD©aToLoÿl
();

31 
»adyToSave
();

32 
£ndQu”yD©a
(cÚ¡ 
QSŒšgLi¡
 &
tmpLi¡
);

33 
£ndB©chC”tifiÿ‹
(cÚ¡ 
QSŒšgLi¡
 &
tmpLi¡
);

34 
£ndCŞËge
(
QSŒšg
 
cŞËge
);

35 
£ndTextFÜLab–
(
QSŒšg
 &
¡r
);

37 
´iv©e
 
	m¦Ùs
:

38 
ÏunchAddStu
();

39 
£ndImpÜtSigÇl
();

40 
£ndExpÜtSigÇl
();

41 
ÏunchR—dy
();

42 
ÏunchQu”y
();

43 
ÏunchB©chC”tifiÿ‹
();

44 
£tCŞËgeComboBox
(
QSŒšgLi¡
 &
¡rLi¡
);

45 
£tCÏssComboBox
(
QSŒšgLi¡
 &
¡rLi¡
);

46 
ÏunchS’dCŞËge
(
QSŒšg
 
cŞËge
);

47 
£tCŞËge
(
QSŒšg
 
¡r
);

48 
£tMajÜ
(
QSŒšg
 
¡r
);

49 
£tOrd”Ru
(
QSŒšg
 
¡r
);

50 
£tStuName
(
QSŒšg
 
¡r
);

51 
£tStuId
(
QSŒšg
 
¡r
);

53 
	m´iv©e
:

54 
Ui
::
CÚŒŞPª–
 *
ui
;

55 
QSŒšg
 
	mcŞËge
, 
	mmajÜ
, 
	mÜd”Ru
, 
	m¡uName
, 
	m¡uId
;

	@datawidget.cpp

1 
	~"d©awidg‘.h
"

2 
	~"ui_d©awidg‘.h
"

3 
	~<QDebug
>

5 
	gD©aWidg‘
::
	$D©aWidg‘
(
QWidg‘
 *
·»Á
) :

6 
	`QWidg‘
(
·»Á
),

7 
	`ui
(
Ãw
 
Ui
::
D©aWidg‘
)

9 
ui
->
	`£tupUi
(
this
);

10 
bËRow
 = 0;

11 
bËCŞ
 = 
TABLE_FIELD
;

13 
mod–
 = 
Ãw
 
	`QSnd¬dI‹mMod–
(
this
);

14 
mod–
->
	`£tRowCouÁ
(
bËRow
);

15 
mod–
->
	`£tCŞumnCouÁ
(
bËCŞ
);

16 
ui
->
bËV›w
->
	`hÜizÚlH—d”
()->
	`£tMovabË
(
Œue
);

17 
ui
->
bËV›w
->
	`£tMod–
(
mod–
);

19 
ui
->
bËV›w
->
	`£tS–eùiÚBehaviÜ
(
QAb¡¿ùI‹mV›w
::
S–eùRows
);

20 
	`š™F›ld
();

21 
	`š™CÚÃùiÚ
();

22 
	}
}

25 
	gD©aWidg‘
::
	$upd©eCÏssQu”y
(
QSŒšg
 
cŞËge
)

27 
QSŒšgLi¡
 
¡rLi¡
;

28 
QSqlD©aba£
 
db
;

29 
QSŒšg
 
sql
;

31 
db
 = 
	`lškDb
(
driv”
, 
dbName
, 
ho¡
, 
u£r
, 
·sswd
);

32 
sql
 = "select distinct major from student where college = '";

33 
sql
 +ğ
cŞËge
;

34 
sql
 += "'";

35 
QSqlQu”y
 
	`que
(
sql
, 
db
);

36 
que
.
	`bšdV®ue
(0, 
cŞËge
);

37 ià(
que
.
	`exec
())

39 
que
.
	`Ãxt
())

41 
¡rLi¡
 << 
que
.
	`v®ue
(0).
	`toSŒšg
();

43 
em™
 
	`£ndCÏssS—rch
(
¡rLi¡
);

44 
	`qDebug
(è<< 
¡rLi¡
;

48 
	`qDebug
() << "Ã»ÓĞÊı¾İ¿â½¨Á¢Á¬½Ó!";

50 
db
.
	`şo£
();

51 
db
.
	`»moveD©aba£
(
QSqlD©aba£
::
deçuÉCÚÃùiÚ
);

52 
	}
}

55 
	gD©aWidg‘
::
	$g‘Qu”yD©a
(cÚ¡ 
QSŒšgLi¡
 &
tmpLi¡
)

57 
QSqlD©aba£
 
db
 = 
	`lškDb
(
driv”
, 
dbName
, 
ho¡
, 
u£r
, 
·sswd
, 
pÜt
);

58 
QSqlQu”y
 
que
;

59 
QSŒšg
 
cŞËge
, 
majÜ
, 
Üd”Ru
, 
¡uName
, 
¡uId
, 
¡rMsg
, 
¡rTmp
;

60 
boŞ
 
Üd”ByStuId
;

61 
row
, 
cŞ
, 
i
;

62 
	`qDebug
(è<< "D©aWidg‘ÕıÔÚ²éÑ¯ÖĞ..." << 
tmpLi¡
;

64 
row
 = 0;

65 
cŞ
 = 
TABLE_FIELD
;

66 
this
->
	`£tTabËRow
(
row
);

68 
cŞËge
 = 
tmpLi¡
.
	`©
(0);

69 
majÜ
 = 
tmpLi¡
.
	`©
(1);

72 ià(
tmpLi¡
.
	`©
(2).
	`toStdSŒšg
() == "Ö¤Êé±àºÅ")

74 
Üd”Ru
 = "certificateNum";

75 
	`qDebug
() << "°´Ö¤Êé±àºÅÅÅĞò";

76 
Üd”ByStuId
 = 
çl£
;

80 
Üd”Ru
 = "stuId";

81 
	`qDebug
() << "°´Ñ§ºÅÅÅĞòºÅ";

82 
Üd”ByStuId
 = 
çl£
;

85 
¡uName
 = 
tmpLi¡
.
	`©
(3);

86 
¡uId
 = 
tmpLi¡
.
	`©
(4);

88 ià(
¡uName
.
	`Ëngth
(è<ğ0 && 
¡uId
.length() > 0)

90 ià(
Üd”ByStuId
)

92 
que
.
	`´•¬e
(
	`Œ
("select * from student where stuId = ? order by stuId‡sc"));

96 
que
.
	`´•¬e
(
	`Œ
("select * from student where stuId = ? order by certificateNum‡sc"));

98 
que
.
	`bšdV®ue
(0, 
¡uId
);

100 ià(
¡uName
.
	`Ëngth
(è> 0 && 
¡uId
.length() <= 0)

102 ià(
Üd”ByStuId
)

104 
que
.
	`´•¬e
(
	`Œ
("select * from student where‚ame = ? order by stuId‡sc"));

108 
que
.
	`´•¬e
(
	`Œ
("select * from student where‚ame = ? order by certificateNum‡sc"));

110 
que
.
	`bšdV®ue
(0, 
¡uName
);

112 ià(
¡uName
.
	`Ëngth
(è> 0 && 
¡uId
.length() > 0)

114 
que
.
	`´•¬e
(
	`Œ
("select * from student where‚ame = ?‡nd stuId = ?"));

115 
que
.
	`bšdV®ue
(0, 
¡uName
);

116 
que
.
	`bšdV®ue
(1, 
¡uId
);

120 ià(
Üd”ByStuId
)

122 
que
.
	`´•¬e
(
	`Œ
("select * from student where college = ?‡nd major = ? order by stuId‡sc"));

126 
que
.
	`´•¬e
(
	`Œ
("select * from student where college = ?‡nd major = ? order by certificateNum‡sc"));

128 
que
.
	`bšdV®ue
(0, 
cŞËge
);

129 
que
.
	`bšdV®ue
(1, 
majÜ
);

131 ià(
que
.
	`exec
())

133 
que
.
	`Ãxt
())

135 
this
->
	`£tTabËRow
(
row
 + 1);

136 
i
 = 0; i < 
cŞ
; ++i)

138 
¡rMsg
 = 
que
.
	`v®ue
(
i
).
	`toSŒšg
();

139 
QSnd¬dI‹m
 *
™em
 = 
Ãw
 
	`QSnd¬dI‹m
(
¡rMsg
);

140 
mod–
->
	`£tI‹m
(
row
, 
i
, 
™em
);

142 ++
row
;

145 
¡rTmp
.
	`£tNum
(
row
);

146 
¡rTmp
 = "ÒÑ²éÑ¯µ½ " + strTmp;

147 
¡rTmp
 += " Ìõ¼ÇÂ¼!";

148 
em™
 
this
->
	`£tTextFÜMaš
(
¡rTmp
);

149 
	`qDebug
(è<< 
¡rTmp
;

153 
QMes§geBox
::
	`w¬nšg
(
this
,

154 
	`Œ
("¾¯¸æ"),r("ÎŞ·¨Á¬½ÓÊı¾İ¿â!"), 
QMes§geBox
::
Yes
, QMes§geBox::
No
);

156 
db
.
	`şo£
();

157 
db
.
	`»moveD©aba£
(
QSqlD©aba£
::
deçuÉCÚÃùiÚ
);

158 
	}
}

161 
	gD©aWidg‘
::
	$g‘B©chC”D©a
(cÚ¡ 
QSŒšgLi¡
 &
tmpLi¡
)

163 
	`qDebug
() << "DataWidgetÕıÔÚÅúÁ¿ÈÏÖ¤ÖĞ...";

165 
QSŒšg
 
g¿Ty³
, 
sql
;

166 
lim™
;

167 
QSqlD©aba£
 
db
;

168 
QMes§geBox
 
ts
;

170 
g¿Ty³
 = 
tmpLi¡
.
	`©
(0);

171 
lim™
 = 
tmpLi¡
.
	`©
(1).
	`toIÁ
();

173 
db
 = 
	`lškDb
(
driv”
, 
dbName
, 
ho¡
, 
u£r
, 
·sswd
);

174 
QSqlQu”y
 
	`que
("", 
db
);

175 
sql
 = "";

176 
que
.
	`´•¬e
(
	`Œ
("update student set certified = 1 whereotalMark >= ?; update student set certified = 0 whereotalMark < ?"));

177 
que
.
	`bšdV®ue
(0, 
lim™
);

178 
que
.
	`bšdV®ue
(1, 
lim™
);

179 ià(
que
.
	`exec
())

181 
db
.
	`şo£
();

182 
db
.
	`»moveD©aba£
(
QSqlD©aba£
::
deçuÉCÚÃùiÚ
);

183 
ts
.
	`£tText
(
	`Œ
("ÒÑÍê³ÉÅúÁ¿ÈÏÖ¤!"));

184 
db
.
	`şo£
();

185 
db
.
	`»moveD©aba£
(
QSqlD©aba£
::
deçuÉCÚÃùiÚ
);

186 
em™
 
this
->
	`£ndLab–Stus
(
	`Œ
("ÅúÁ¿ÈÏÖ¤ÒÑÍê³É!"));

190 
ts
.
	`£tText
(
	`Œ
("ÅúÁ¿ÈÏÖ¤³ö´í, ÇëÈ·±£MySQLÒÑÆô¶¯!"));

192 
ts
.
	`£tWšdowT™Ë
(
	`Œ
("ÈÏÖ¤½á¹û:"));

193 
ts
.
	`£tWšdowIcÚ
(
	`QIcÚ
(":/images/hutIcon.ico"));

194 
ts
.
	`£tSnd¬dBu‰Ús
(
QMes§geBox
::
Yes
 | QMes§geBox::
No
);

195 
ts
.
	`exec
();

196 
	}
}

199 
	gD©aWidg‘
::
	$§veCu¼’tRecÜd
()

201 
i
, 
j
, 
row
, 
cŞ
, 
sum
;

202 
QSqlD©aba£
 
db
;

203 
QSŒšg
 
¡r
, 
¡rCurRow
, 
¡rCurCŞ
, 
¡rMsg
, 
¡rTmp
;

204 
QRegExp
 
	`»g
("^\\d+$");

205 
QMes§geBox
 
ts
;

207 
row
 = 
this
->
	`g‘TabËRow
();

208 
cŞ
 = 
this
->
	`g‘TabËCŞ
();

209 
db
 = 
	`lškDb
(
driv”
, 
dbName
, 
ho¡
, 
u£r
, 
·sswd
);

210 
QSqlQu”y
 
	`que
("", 
db
);

211 
sum
 = 0;

212 
i
 = 0; i < 
row
; ++i)

214 
que
.
	`´•¬e
(
	`Œ
("insert into student values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"));

215 
j
 = 0; j < 
cŞ
; ++j)

217 ià((
j
 >= 13 && j <= 23))

219 
¡r
 = 
mod–
->
	`™em
(
i
, 
j
)->
	`‹xt
();

220 ià(
»g
.
	`exaùM©ch
(
¡r
))

222 
que
.
	`bšdV®ue
(
j
, 
¡r
.
	`toIÁ
());

226 
¡rCurRow
.
	`£tNum
(
i
 + 1, 10);

227 
	`qDebug
(è<< 
¡rCurRow
;

229 
¡rMsg
 = 
	`Œ
("Ëùµ¼ÈëµÄÊı¾İµÚ");

230 
¡rMsg
 +ğ
¡rCurRow
;

231 
¡rMsg
 += "ĞĞ, µÚ";

232 
¡rCurCŞ
.
	`£tNum
(
j
 + 1, 10);

233 
¡rMsg
 +ğ
¡rCurCŞ
;

234 
¡rMsg
 += "ÁĞ²»ºÏ·¨, ÏµÍ³½«Í£Ö¹µ¼Èë, Çë¼ì²é!";

235 
QMes§geBox
::
	`w¬nšg
(
this
, 
	`Œ
("¾¯¸æ!"),

236 
¡rMsg
, 
QMes§geBox
::
Yes
, QMes§geBox::
No
);

237 
db
.
	`rŞlback
();

241 ià(
j
 == 25)

243 
¡r
 = 
mod–
->
	`™em
(
i
, 
j
)->
	`‹xt
();

244 ià(
¡r
 == "ÊÇ" || str == "1")

247 
que
.
	`bšdV®ue
(
j
, 0);

251 
que
.
	`bšdV®ue
(
j
, 0);

256 
que
.
	`bšdV®ue
(
j
, 
mod–
->
	`™em
(
i
, j)->
	`‹xt
());

259 ià(
que
.
	`exec
())

261 ++
sum
;

265 
¡rMsg
 = "ÓĞ";

266 
¡rTmp
.
	`£tNum
(
sum
);

267 
¡rMsg
 +ğ
¡rTmp
;

268 
¡rMsg
 += "Ìõ¼ÇÂ¼±»Ğ´ÈëÊı¾İ¿â";

270 
ts
.
	`£tText
(
¡rMsg
);

271 
ts
.
	`£tSnd¬dBu‰Ús
(
QMes§geBox
::
Yes
 | QMes§geBox::
No
);

272 
ts
.
	`£tWšdowT™Ë
(
	`Œ
("½á¹û:"));

273 
ts
.
	`£tWšdowIcÚ
(
	`QIcÚ
(":/images/hutIcon.ico"));

274 
ts
.
	`exec
();

275 
this
->
	`£tTabËRow
(0);

276 
this
->
	`£tTabËCŞ
(
cŞ
);

278 
que
.
	`exec
(
	`Œ
("select distinct college from student"));

279 
QSŒšgLi¡
 
cŞSŒLi¡
;

280 
cŞSŒLi¡
.
	`ş—r
();

281 
que
.
	`Ãxt
())

283 
cŞSŒLi¡
 << 
que
.
	`v®ue
(0).
	`toSŒšg
();

285 
em™
 
	`£ndCŞËgeS—rch
(
cŞSŒLi¡
);

286 
	`qDebug
(è<< 
cŞSŒLi¡
 << "emit sendCollegeSearch(colStrList)";

288 
db
.
	`şo£
();

289 
db
.
	`»moveD©aba£
(
QSqlD©aba£
::
deçuÉCÚÃùiÚ
);

291 
	}
}

294 
QSŒšgLi¡
 
	gD©aWidg‘
::
	$g‘LškDbMsg
()

296  
lškMsg
;

297 
	}
}

300 
	gD©aWidg‘
::
	$£tLškDbMsg
(cÚ¡ 
QSŒšgLi¡
 &
tmpMsg
)

302 
lškMsg
 = 
tmpMsg
;

304 
driv”
 = 
lškMsg
.
	`©
(0);

305 
dbName
 = 
lškMsg
.
	`©
(1);

306 
ho¡
 = 
lškMsg
.
	`©
(2);

307 
u£r
 = 
lškMsg
.
	`©
(3);

308 
·sswd
 = 
lškMsg
.
	`©
(4);

309 
pÜt
 = 
lškMsg
.
	`©
(5).
	`toIÁ
();

310 
	`qDebug
() << "ÒÑ·Ö½âÁ¬½ÓÊı¾İ¿âµÄĞÅÏ¢:";

311 
	`qDebug
(è<< 
driv”
 << 
dbName
 << 
ho¡
 << 
u£r
 << 
·sswd
 << 
pÜt
;

312 
	}
}

314 
	gD©aWidg‘
::
	$g‘LškMsg
(
QSŒšgLi¡
 &
¡rLi¡
)

316 
lškMsg
 = 
¡rLi¡
;

317 
	}
}

320 
QSqlD©aba£
 
	gD©aWidg‘
::
	$lškDb
(cÚ¡ 
QSŒšg
 &
driv”
, cÚ¡ QSŒšg &
dbName
,

321 cÚ¡ 
QSŒšg
 &
ho¡
, cÚ¡ QSŒšg &
u£r
, cÚ¡ QSŒšg &
·sswd
, 
pÜt
)

323 
QSqlE¼Ü
 
”r
;

324 
QSqlD©aba£
 
db
 = QSqlD©aba£::
	`addD©aba£
(
driv”
);

325 
db
.
	`£tHo¡Name
(
ho¡
);

326 
db
.
	`£tD©aba£Name
(
dbName
);

327 
db
.
	`£tPÜt
(
pÜt
);

328 ià(!
db
.
	`İ’
(
u£r
, 
·sswd
è|| u£¸!ğ
	`Œ
("root"))

330 
”r
 = 
db
.
	`Ï¡E¼Ü
();

331 
QMes§geBox
::
	`w¬nšg
(
this
, 
	`Œ
("¾¯¸æ"),

332 "Á¬½ÓMySql³ö´í, ÇëÈ·±£MySqlÒÑÆô¶¯ÇÒÓÃ»§ÃûºÍÃÜÎŞÎó!", 
QMes§geBox
::
Ok
);

333 ià(
db
.
	`isO³n
())

335 
db
.
	`şo£
();

339  
db
;

340 
	}
}

343 
	gD©aWidg‘
::
	$impÜtD©a
()

346 
QSŒšg
 
f’ame
, 
¡rLše
, 
¡r
;

347 
QSŒšgLi¡
 
¡rLi¡
;

348 
QRegExp
 
	`»g
("\\s+");

349 
QMes§geBox
 
ts
;

350 
i
, 
Ën
, 
šdex
, 
sum
;

352 
f’ame
 = 
QFeDŸlog
::
	`g‘O³nFeName
(
this
,

353 
	`Œ
("µ¼ÈëÎÄ¼ş"), "./",r("Text Documents (*.txt)"));

355 
QFe
 
	`fe
(
f’ame
);

356 ià(
fe
.
	`İ’
(
QIODeviû
::
R—dOÆy
))

358 
QTextSŒ—m
 
	`š
(&
fe
);

359 (
¡rLše
 = 
š
.
	`»adLše
()), sŒLše.
	`Ëngth
() > 0)

361 
¡rLi¡
 = 
¡rLše
.
	`¥l™
(
»g
);

362 
	`qDebug
(è<< 
¡rLi¡
;

363 
Ën
 = 
¡rLi¡
.
	`Ëngth
();

364 
i
 = 0; i < 
Ën
 && i < 
TABLE_FIELD
; ++i)

366 
QSnd¬dI‹m
 *
™em
 = 
Ãw
 
	`QSnd¬dI‹m
(
¡rLi¡
.
	`©
(
i
));

367 
mod–
->
	`£tI‹m
(
	`g‘TabËRow
(), 
i
, 
™em
);

369 
this
->
	`£tTabËRow
(
	`g‘TabËRow
() + 1);

372 
¡r
 = "ÒÑµ¼Èë ";

373 
sum
 = 
	`g‘TabËRow
();

374 ià(
sum
 == 0)

376 
¡r
 = str + '0';

378 
sum
)

380 
šdex
 = 
sum
 % 10;

381 
sum
 /= 10;

382 
¡r
 = (
šdex
 + '0') + str;

384 
¡r
 = str + " Ìõ¼ÇÂ¼!";

386 
ts
.
	`£tText
(
	`Œ
("ÊÇ·ñ½«µ±Ç°±íÖĞµÄÊı¾İµ¼ÈëÊı¾İ¿â?"));

387 
ts
.
	`£tSnd¬dBu‰Ús
(
QMes§geBox
::
Yes
 | QMes§geBox::
No
);

388 
ts
.
	`£tWšdowT™Ë
(
	`Œ
("ÌáÊ¾:"));

389 
ts
.
	`£tWšdowIcÚ
(
	`QIcÚ
(":/images/hutIcon.ico"));

390 ià(
ts
.
	`exec
(è=ğ
QMes§geBox
::
Yes
)

392 
	`§veCu¼’tRecÜd
();

393 
em™
 
	`£ndLab–Stus
(
¡r
);

396 
	}
}

399 
	gD©aWidg‘
::
	$expÜtD©a
()

401 
QSqlD©aba£
 
db
;

402 
QSŒšg
 
f’ame
;

403 
QSŒšg
 
¡r
, 
sql
;

404 
i
, 
j
, 
cŞ
 = 
TABLE_FIELD
, 
Ën
;

405 
QMes§geBox
 
ts
;

406 
QRegExp
 
	`»g
("*.xls*");

409 
ts
.
	`£tText
(
	`Œ
("ÒÑ³É¹¦½«Êı¾İµ¼³ö!"));

410 
ts
.
	`£tWšdowT™Ë
(
	`Œ
("ÌáÊ¾:"));

411 
ts
.
	`£tWšdowIcÚ
(
	`QIcÚ
(":/images/hutIcon.ico"));

412 
ts
.
	`£tSnd¬dBu‰Ús
(
QMes§geBox
::
Yes
 | QMes§geBox::
No
);

414 
f’ame
 = 
QFeDŸlog
::
	`g‘SaveFeName
(
this
,

415 
	`Œ
("µ¼³ö"), "./",r("Text Documents (*.txt);;Excel ¹¤×÷²¾ (*.xls)"));

417 
Ën
 = 
f’ame
.
	`Ëngth
();

418 ià(
f’ame
.
	`©
(
Ën
 - 1).
	`toAscii
() == 's' ||

419 
f’ame
.
	`©
(
Ën
 - 1).
	`toAscii
() == 'x')

421 
	`qDebug
() << "µ¼³öexcel";

422 
sql
 = "select * from student order by stuId‡sc into outfile '";

423 
sql
 +ğ
f’ame
;

424 
sql
 += "'";

425 
db
 = 
	`lškDb
(
driv”
, 
dbName
, 
ho¡
, 
u£r
, 
·sswd
, 
pÜt
);

426 
QSqlQu”y
 
	`que
(
sql
, 
db
);

427 
	`qDebug
(è<< 
sql
;

428 ià(
que
.
	`exec
())

430 
ts
.
	`exec
();

432 
db
.
	`şo£
();

433 
db
.
	`»moveD©aba£
(
QSqlD©aba£
::
deçuÉCÚÃùiÚ
);

434 
em™
 
this
->
	`£ndLab–Stus
(
	`Œ
("Êı¾İÒÑµ¼³ö!"));

438 
sql
 = 
	`Œ
("select * from student order by stuId‡sc");

439 
QFe
 
	`fe
(
f’ame
);

441 ià(
fe
.
	`İ’
(
QIODeviû
::
Wr™eOÆy
))

443 
QTextSŒ—m
 
	`out
(&
fe
);

444 
db
 = 
	`lškDb
(
driv”
, 
dbName
, 
ho¡
, 
u£r
, 
·sswd
, 
pÜt
);

445 
sql
 = "select * from student";

446 
QSqlQu”y
 
	`que
(
sql
, 
db
);

447 ià(
que
.
	`exec
())

449 
que
.
	`Ãxt
())

451 
¡r
 = "";

452 
i
 = 0; i < 
cŞ
; ++i)

454 
¡r
 +ğ
que
.
	`v®ue
(
i
).
	`toSŒšg
();

455 ià(
i
 + 1 =ğ
cŞ
)

457 
¡r
 += '\r';

458 
¡r
 += '\n';

462 
¡r
 += ' ';

465 
out
 << 
¡r
;

467 
em™
 
this
->
	`£ndLab–Stus
(
	`Œ
("Êı¾İÒÑµ¼³ö!"));

469 
ts
.
	`exec
();

471 
db
.
	`şo£
();

472 
db
.
	`»moveD©aba£
(
QSqlD©aba£
::
deçuÉCÚÃùiÚ
);

474 
	}
}

476 
	gD©aWidg‘
::
	$addStuRecÜd
()

478 
i
, 
Ën
;

479 
QSnd¬dI‹m
 *
™em
 = 
NULL
;

481 
Ën
 = 
TABLE_FIELD
;

482 
i
 = 0; i < 
Ën
; ++i)

484 ià((
i
 >= 13 && i <= 23) || i == 25)

486 
™em
 = 
Ãw
 
	`QSnd¬dI‹m
(
	`Œ
("0"));

490 
™em
 = 
Ãw
 
	`QSnd¬dI‹m
(
	`Œ
(""));

492 
mod–
->
	`£tI‹m
(
bËRow
, 
i
, 
™em
);

494 
mod–
->
	`£tRowCouÁ
(++
bËRow
);

496 
em™
 
this
->
	`£ndLab–Stus
(
	`Œ
("¿Õ¼ÇÂ¼ÒÑÌí¼Ó, ÇëÌîĞ´!"));

497 
	}
}

499 
	gD©aWidg‘
::
	$subStuRecÜd
()

501 
QMes§geBox
 
ts
;

502 
QSŒšg
 
¡r
, 
sql
, 
¡rTmp
;

503 
QSqlD©aba£
 
db
;

505 
ts
.
	`£tWšdowT™Ë
(
	`Œ
("É¾³ı:"));

506 
ts
.
	`£tSnd¬dBu‰Ús
(
QMes§geBox
::
Yes
 | QMes§geBox::
No
);

507 
ts
.
	`£tWšdowIcÚ
(
	`QIcÚ
(":/images/hutIcon.ico"));

508 ià(
bËRow
 > 0)

510 
¡rTmp
 = 
mod–
->
	`™em
(
bËRow
 - 1, 0)->
	`‹xt
();

511 
¡r
 = "ÊÇ·ñÉ¾³ıÖ¤Êé±àºÅÎª:";

512 
¡r
 +ğ
¡rTmp
;

513 
¡r
 += "ÕâÒ»¼ÇÂ¼?";

514 
ts
.
	`£tText
(
¡r
);

515 ià(
ts
.
	`exec
(è=ğ
QMes§geBox
::
Yes
)

517 
db
 = 
	`lškDb
(
driv”
, 
dbName
, 
ho¡
, 
u£r
, 
·sswd
, 
pÜt
);

518 
sql
 = 
	`Œ
("delete from student where certificateNum = '");

519 
sql
 +ğ
¡rTmp
;

520 
sql
 += "'";

521 
QSqlQu”y
 
	`que
(
sql
, 
db
);

522 ià(
que
.
	`exec
(
sql
))

524 
mod–
->
	`»moveRow
(
bËRow
 - 1);

525 
mod–
->
	`£tRowCouÁ
(--
bËRow
);

526 
ts
.
	`£tText
(
	`Œ
("É¾³ı³É¹¦!"));

527 
em™
 
	`£ndLab–Stus
(
	`Œ
("ÒÑÉ¾±í¸ñ×îºóÒ»Ìõ¼ÇÂ¼!"));

531 
ts
.
	`£tText
(
	`Œ
("É¾³ıÊ§°Ü!"));

533 
ts
.
	`exec
();

536 
	}
}

539 
	gD©aWidg‘
::
	$š™F›ld
()

541 
QSŒšg
 
¡r
 = 
	`Œ
("Ö¤Êé±àºÅ Ñ§ºÅ ĞÕÃû ĞÔ±ğ Ãñ×å ³öÉúÄêÔÂ ³öÉúµØ ÕşÖÎÃæÃ² Ñ§Ğ£ Ñ§Ôº ×¨Òµ ÈëÑ§Ê±¼ä ±ÏÒµÉúÀàĞÍ Ñ§ÆÚÒ» Ñ§ÆÚ¶ş Ñ§ÆÚÈı Ñ§ÆÚËÄ Ñ§ÆÚÎå Ñ§ÆÚÁù Ñ§ÆÚÆß Ñ§ÆÚ°Ë Ñ§ÆÚ¾Å Ñ§ÆÚÊ® ×Ü·Ö ±¸×¢ ÈÏÖ¤");

542 
QSŒšgLi¡
 
¡rLi¡
;

543 
i
, 
Ën
;

545 
¡rLi¡
 = 
¡r
.
	`¥l™
(
	`QRegExp
("\\s+"));

546 
Ën
 = 
¡rLi¡
.
	`Ëngth
();

547 
i
 = 0; i < 
Ën
; ++i)

549 
mod–
->
	`£tH—d”D©a
(
i
, 
Qt
::
HÜizÚl
, 
¡rLi¡
.
	`©
(i));

551 
	}
}

553 
	gD©aWidg‘
::
	$š™CÚÃùiÚ
()

555 
	`cÚÃù
(
this
->
mod–
, 
	`SIGNAL
(
	`™emChªged
(
QSnd¬dI‹m
*)), mod–, 
	`SLOT
(
	`subm™
()));

556 
	}
}

558 
	gD©aWidg‘
::
	$£tTabËRow
(cÚ¡ &
_row
)

560 
bËRow
 = 
_row
;

561 
mod–
->
	`£tRowCouÁ
(
bËRow
);

562 
	}
}

564 
	gD©aWidg‘
::
	$£tTabËCŞ
(cÚ¡ &
_cŞ
)

566 
bËCŞ
 = 
_cŞ
;

567 
	}
}

569 
	gD©aWidg‘
::
	$g‘TabËRow
()

571  
bËRow
;

572 
	}
}

574 
	gD©aWidg‘
::
	$g‘TabËCŞ
()

576  
bËCŞ
;

577 
	}
}

580 
	gD©aWidg‘
::
	$š£¹IÁoTabË
(
QSŒšgLi¡
 &
¡rLi¡
)

582 
i
, 
Ën
;

583 
QSŒšg
 
¡r
;

585 
Ën
 = 
¡rLi¡
.
	`Ëngth
();

586 
i
 = 0; i < 
Ën
 && i < 
TABLE_FIELD
; ++i)

588 
¡r
 = 
¡rLi¡
.
	`©
(
i
);

589 
QSnd¬dI‹m
 *
™em
 = 
Ãw
 
	`QSnd¬dI‹m
(
¡r
);

590 
mod–
->
	`£tI‹m
(
this
->
	`g‘TabËRow
(), 
i
, 
™em
);;

593 
this
->
	`£tTabËRow
Ñhis->
	`g‘TabËRow
() + 1);

594 
	}
}

596 
	gD©aWidg‘
::~
	$D©aWidg‘
()

598 
d–‘e
 
ui
;

600 
	`qDebug
() << "ÒÑÊÕµ½À´×ÔLoginDlgÁ¬½ÓÊı¾İ¿âµÄĞÅÏ¢!";

601 
	`qDebug
(è<< 
lškMsg
;

602 
	}
}

	@datawidget.h

1 #iâdeà
DATAWIDGET_H


2 
	#DATAWIDGET_H


	)

4 
	~<QWidg‘
>

5 
	~<QSnd¬dI‹mMod–
>

6 
	~<QSnd¬dI‹m
>

7 
	~<QSqlD©aba£
>

8 
	~<QSqlQu”y
>

9 
	~<QSqlE¼Ü
>

10 
	~<QFeDŸlog
>

11 
	~<QTextSŒ—m
>

12 
	~<QFe
>

13 
	~<QRegExp
>

14 
	~<QIcÚ
>

15 
	~"¡ud’t.h
"

16 
	#TABLE_FIELD
 26

	)

18 
Çme¥aû
 
	gUi
 {

19 
şass
 
	gD©aWidg‘
;

22 şas 
	cD©aWidg‘
 : 
public
 
QWidg‘


24 
Q_OBJECT


26 
public
:

27 
ex¶ic™
 
D©aWidg‘
(
QWidg‘
 *
·»Á
 = 0);

28 ~
D©aWidg‘
();

29 
š™F›ld
();

30 
š™CÚÃùiÚ
();

31 
£tTabËRow
(cÚ¡ &
_row
);

32 
£tTabËCŞ
(cÚ¡ &
_cŞ
);

33 
g‘TabËRow
();

34 
g‘TabËCŞ
();

35 
QSqlD©aba£
 
lškDb
(cÚ¡ 
QSŒšg
 &
driv”
, cÚ¡ QSŒšg &
dbName
, cÚ¡ QSŒšg &
ho¡
,

36 cÚ¡ 
QSŒšg
 &
u£r
, cÚ¡ QSŒšg &
·sswd
, 
pÜt
 = 3306);

37 
£tLškDbMsg
(cÚ¡ 
QSŒšgLi¡
 &
tmpMsg
);

38 
QSŒšgLi¡
 
g‘LškDbMsg
();

41 
QSŒšg
 
	$g‘Driv”
(è{  
driv”
; }

42 
QSŒšg
 
	$g‘dbName
(è{  
dbName
; 
	}
}

43 
QSŒšg
 
	$g‘Ho¡
(è{  
ho¡
; 
	}
}

44 
QSŒšg
 
	$g‘U£r
(è{  
u£r
; 
	}
}

45 
QSŒšg
 
	$g‘Pwd
(è{  
·sswd
; 
	}
}

46 
	$g‘PÜt
(è{  
pÜt
; 
	}
}

48 
	gsigÇls
:

49 
£ndLab–Stus
(
QSŒšg
 &
¡u
);

50 
£ndCŞËgeS—rch
(
QSŒšgLi¡
 &
¡rLi¡
);

51 
£ndCÏssS—rch
(
QSŒšgLi¡
 &
¡rLi¡
);

52 
£tTextFÜMaš
(
QSŒšg
 &
¡r
);

54 
´iv©e
 
	g¦Ùs
:

55 
addStuRecÜd
();

56 
subStuRecÜd
();

57 
š£¹IÁoTabË
(
QSŒšgLi¡
 &
¡rLi¡
);

58 
impÜtD©a
();

59 
expÜtD©a
();

60 
g‘LškMsg
(
QSŒšgLi¡
 &
¡rLi¡
);

61 
§veCu¼’tRecÜd
();

62 
g‘Qu”yD©a
(cÚ¡ 
QSŒšgLi¡
 &
tmpLi¡
);

63 
g‘B©chC”D©a
(cÚ¡ 
QSŒšgLi¡
 &
tmpLi¡
);

64 
upd©eCÏssQu”y
(
QSŒšg
 
cŞËge
);

66 
	gpublic
:

67 
QSnd¬dI‹mMod–
 *
mod–
;

68 
	gbËRow
, 
	gbËCŞ
;

70 
	g´iv©e
:

71 
Ui
::
D©aWidg‘
 *
ui
;

72 
QSŒšgLi¡
 
	glškMsg
;

73 
QSŒšg
 
	gdriv”
, 
	gdbName
, 
	gho¡
, 
	gu£r
, 
	g·sswd
;

74 
	gpÜt
;

	@hutclient.cpp

1 
	~"hutş›Á.h
"

2 
	~"ui_hutş›Á.h
"

4 
	gHutCl›Á
::
	$HutCl›Á
(
QWidg‘
 *
·»Á
) :

5 
	`QMašWšdow
(
·»Á
),

6 
	`ui
(
Ãw
 
Ui
::
HutCl›Á
)

8 
ui
->
	`£tupUi
(
this
);

9 
	`š™MašWidg‘
();

10 
	`š™MašAùiÚ
();

11 
	`š™CÚÃùiÚ
();

12 
	}
}

14 
	gHutCl›Á
::
	$š™CÚÃùiÚ
()

17 
	`cÚÃù
(
ui
->
aùImp
, 
	`SIGNAL
(
	`Œigg”ed
()),

18 
cÚŒŞPª–
, 
	`SLOT
(
	`£ndImpÜtSigÇl
()));

19 
	`cÚÃù
(
ui
->
aùExp
, 
	`SIGNAL
(
	`Œigg”ed
()),

20 
cÚŒŞPª–
, 
	`SLOT
(
	`£ndExpÜtSigÇl
()));

21 
	`cÚÃù
(
ui
->
aùEx™
, 
	`SIGNAL
(
	`Œigg”ed
()),

22 
this
, 
	`SLOT
(
	`şo£
()));

23 
	`cÚÃù
(
ui
->
aùS—rch
, 
	`SIGNAL
(
	`Œigg”ed
()),

24 
cÚŒŞPª–
, 
	`SLOT
(
	`ÏunchQu”y
()));

25 
	`cÚÃù
(
ui
->
aùAbout
, 
	`SIGNAL
(
	`Œigg”ed
()),

26 
this
, 
	`SLOT
(
	`showAuthÜMsg
()));

28 
	`cÚÃù
(
ui
->
aùPª–
, 
	`SIGNAL
(
	`Œigg”ed
()),

29 
this
, 
	`SLOT
(
	`ÿÎCÚŒŞPª–
()));

31 
	`cÚÃù
(
cÚŒŞPª–
, 
	`SIGNAL
(
	`ÚAddStuClicked
()),

32 
¡u
, 
	`SLOT
(
	`show
()));

35 
	`cÚÃù
(
¡u
, 
	`SIGNAL
(
	`subm™Stu
(
QSŒšgLi¡
&)),

36 
d©aWidg‘
, 
	`SLOT
(
	`š£¹IÁoTabË
(
QSŒšgLi¡
&)));

39 
	`cÚÃù
(
this
->
addTabËRow
, 
	`SIGNAL
(
	`Œigg”ed
()),

40 
d©aWidg‘
, 
	`SLOT
(
	`addStuRecÜd
()));

41 
	`cÚÃù
(
this
->
subTabËRow
, 
	`SIGNAL
(
	`Œigg”ed
()),

42 
d©aWidg‘
, 
	`SLOT
(
	`subStuRecÜd
()));

45 
	`cÚÃù
(
this
->
cÚŒŞPª–
, 
	`SIGNAL
(
	`impÜtD©aToTabË
()),

46 
d©aWidg‘
, 
	`SLOT
(
	`impÜtD©a
()));

47 
	`cÚÃù
(
this
->
cÚŒŞPª–
, 
	`SIGNAL
(
	`expÜtD©aToLoÿl
()),

48 
d©aWidg‘
, 
	`SLOT
(
	`expÜtD©a
()));

51 
	`cÚÃù
(
this
->
cÚŒŞPª–
, 
	`SIGNAL
(
	`»adyToSave
()),

52 
d©aWidg‘
, 
	`SLOT
(
	`§veCu¼’tRecÜd
()));

55 
	`cÚÃù
(
cÚŒŞPª–
, 
	`SIGNAL
(
	`£ndQu”yD©a
(cÚ¡ 
QSŒšgLi¡
&)),

56 
d©aWidg‘
, 
	`SLOT
(
	`g‘Qu”yD©a
(cÚ¡ 
QSŒšgLi¡
&)));

59 
	`cÚÃù
(
cÚŒŞPª–
, 
	`SIGNAL
(
	`£ndB©chC”tifiÿ‹
(cÚ¡ 
QSŒšgLi¡
&)),

60 
d©aWidg‘
, 
	`SLOT
(
	`g‘B©chC”D©a
(cÚ¡ 
QSŒšgLi¡
&)));

63 
	`cÚÃù
(
d©aWidg‘
, 
	`SIGNAL
(
	`£ndCŞËgeS—rch
(
QSŒšgLi¡
&)),

64 
cÚŒŞPª–
, 
	`SLOT
(
	`£tCŞËgeComboBox
(
QSŒšgLi¡
&)));

67 
	`cÚÃù
(
cÚŒŞPª–
, 
	`SIGNAL
(
	`£ndCŞËge
(
QSŒšg
)),

68 
d©aWidg‘
, 
	`SLOT
(
	`upd©eCÏssQu”y
(
QSŒšg
)));

69 
	`cÚÃù
(
d©aWidg‘
, 
	`SIGNAL
(
	`£ndCÏssS—rch
(
QSŒšgLi¡
&)),

70 
cÚŒŞPª–
, 
	`SLOT
(
	`£tCÏssComboBox
(
QSŒšgLi¡
&)));

73 
	`cÚÃù
(
¡u
, 
	`SIGNAL
(
	`£ndTextFÜLab–
(
QSŒšg
&)),

74 
this
, 
	`SLOT
(
	`£tLab–Stus
(
QSŒšg
&)));

75 
	`cÚÃù
(
d©aWidg‘
, 
	`SIGNAL
(
	`£ndLab–Stus
(
QSŒšg
&)),

76 
this
, 
	`SLOT
(
	`£tLab–Stus
(
QSŒšg
&)));

77 
	`cÚÃù
(
d©aWidg‘
, 
	`SIGNAL
(
	`£tTextFÜMaš
(
QSŒšg
&)),

78 
this
, 
	`SLOT
(
	`£tLab–Stus
(
QSŒšg
&)));

79 
	`cÚÃù
(
cÚŒŞPª–
, 
	`SIGNAL
(
	`£ndTextFÜLab–
(
QSŒšg
&)),

80 
this
, 
	`SLOT
(
	`£tLab–Stus
(
QSŒšg
&)));

81 
	}
}

83 
	gHutCl›Á
::
	$£tLab–Stus
(
QSŒšg
 &
¡r
)

85 
Ïb–
->
	`£tText
(
¡r
);

86 
	}
}

88 
	gHutCl›Á
::
	$ÏunchStud’t
()

90 ià(
¡u
 =ğ
NULL
)

92 
¡u
 = 
Ãw
 
	`Stud’t
(
this
);

93 
¡u
->
	`show
();

97 
¡u
->
	`show
();

99 
	}
}

101 
	gHutCl›Á
::
	$showAuthÜMsg
()

103 
QMes§geBox
 
t
;

104 
QSŒšg
 
msg
 = "Based on Qt 4.7.4 (32bit)\nBuilt on Nov. 15 2011‡t 17:10:00\nCopyright @ www.icedy.com.All„ight„eserved.\n";

105 
msg
 += "Technical Support:young.cpy@gmail.com";

107 
t
.
	`£tText
(
	`Œ
("About HutClient"));

108 
t
.
	`£tText
(
msg
);

109 
t
.
	`£tSnd¬dBu‰Ús
(
QMes§geBox
::
Clo£
);

110 
t
.
	`exec
();

111 
	}
}

113 
	gHutCl›Á
::
	$š™MašAùiÚ
()

115 
ui
->
toŞB¬
->
	`addAùiÚ
(ui->
aùImp
);

116 
ui
->
toŞB¬
->
	`addAùiÚ
(ui->
aùExp
);

117 
ui
->
toŞB¬
->
	`addAùiÚ
(ui->
aùPª–
);

118 
ui
->
toŞB¬
->
	`addAùiÚ
(ui->
aùS—rch
);

119 
addTabËRow
 = 
ui
->
toŞB¬
->
	`addAùiÚ
(
	`Œ
("Ìí¼Ó±íÏî"));

120 
addTabËRow
->
	`£tShÜtcut
(
	`QKeySequ’û
("CTRL++"));

121 
addTabËRow
->
	`£tToŞT
(
	`Œ
("CTRL +"));

122 
subTabËRow
 = 
ui
->
toŞB¬
->
	`addAùiÚ
(
	`Œ
("É¾³ı±íÏî"));

123 
subTabËRow
->
	`£tShÜtcut
(
	`QKeySequ’û
(
	`Œ
("CTRL+-")));

124 
subTabËRow
->
	`£tToŞT
(
	`Œ
("CTRL -"));

125 
	}
}

127 
	gHutCl›Á
::
	$š™MašWidg‘
()

129 
QStusB¬
 *
b¬
;

130 
QSŒšgLi¡
 
lškDbMsg
;

131 
¡©us
;

134 
logš
 = 
Ãw
 
	`LogšDlg
(
this
);

135 ià((
¡©us
 = 
logš
->
	`exec
()è!ğ
QDŸlog
::
Acû±ed
)

137 ià(
logš
 !ğ
NULL
)

139 
d–‘e
 
logš
;

140 
logš
 = 
NULL
;

142 
	`ex™
(0);

146 
d©aWidg‘
 = 
Ãw
 
	`D©aWidg‘
(
this
);

147 
	`£tC’Œ®Widg‘
(
d©aWidg‘
);

149 ià(
¡©us
 =ğ
QDŸlog
::
Acû±ed
)

151 
lškDbMsg
 = 
logš
->
	`g‘LškMsg
();

152 
d©aWidg‘
->
	`£tLškDbMsg
(
lškDbMsg
);

153 
	`qDebug
() << "ÒÑÉèÖÃ!";

154 
	`qDebug
(è<< 
d©aWidg‘
->
	`g‘LškDbMsg
();

158 
dock
 = 
Ãw
 
	`QDockWidg‘
(
	`Œ
("¿ØÖÆÃæ°å"), 
this
);

159 
cÚŒŞPª–
 = 
Ãw
 
	`CÚŒŞPª–
(
dock
);

160 
dock
->
	`£tAÎowedA»as
(
Qt
::
LeáDockWidg‘A»a
 | Qt::
RightDockWidg‘A»a
);

161 
dock
->
	`£tWidg‘
(
cÚŒŞPª–
);

162 
	`addDockWidg‘
(
Qt
::
LeáDockWidg‘A»a
, 
dock
);

165 
	`£tWšdowIcÚ
(
	`QIcÚ
(":/images/hutIcon.ico"));

166 
	`£tWšdowT™Ë
(
	`Œ
("´óÑ§ÉúËØÖÊÍØÕ¹¹ÜÀíÏµÍ³"));

169 
b¬
 = 
	`¡©usB¬
();

170 
Ïb–
 = 
Ãw
 
	`QLab–
(
b¬
);

171 
Ïb–
->
	`£tMšimumSize
(200, 20);

172 
Ïb–
->
	`£tF¿meShadow
(
QF¿me
::
Sunk’
);

173 
Ïb–
->
	`£tF¿meSh­e
(
QF¿me
::
WšPª–
);

174 
Ïb–
->
	`£tText
(
	`Œ
("µÇÂ½³É¹¦!"));

175 
b¬
->
	`addWidg‘
(
Ïb–
);

178 
¡u
 = 
Ãw
 
	`Stud’t
(
this
);

179 
¡u
->
	`£tVisibË
(
çl£
);

180 
	}
}

183 
	gHutCl›Á
::
	$ÿÎCÚŒŞPª–
()

185 ià(
dock
->
	`isHidd’
())

187 
dock
->
	`show
();

191 
dock
->
	`hide
();

193 
	}
}

195 
	gHutCl›Á
::~
	$HutCl›Á
()

197 
	`qDebug
() << "main widget was„eleased!";

198 
d–‘e
 
ui
;

199 ià(
Ïb–
 !ğ
NULL
)

201 
d–‘e
 
Ïb–
;

202 
Ïb–
 = 
NULL
;

205 ià(
cÚŒŞPª–
 !ğ
NULL
)

207 
d–‘e
 
cÚŒŞPª–
;

208 
cÚŒŞPª–
 = 
NULL
;

211 if(
d©aWidg‘
 !ğ
NULL
)

213 
d–‘e
 
d©aWidg‘
;

214 
d©aWidg‘
 = 
NULL
;

217 ià(
dock
 !ğ
NULL
)

219 
d–‘e
 
dock
;

220 
dock
 = 
NULL
;

223 ià(
¡u
 !ğ
NULL
)

225 
d–‘e
 
¡u
;

226 
¡u
 = 
NULL
;

229 ià(
logš
 !ğ
NULL
)

231 
d–‘e
 
logš
;

232 
logš
 = 
NULL
;

234 
	}
}

	@hutclient.h

1 #iâdeà
HUTCLIENT_H


2 
	#HUTCLIENT_H


	)

4 
	~<QMašWšdow
>

5 
	~<QDockWidg‘
>

6 
	~<QLab–
>

7 
	~<QStusB¬
>

8 
	~"logšdlg.h
"

9 
	~"cÚŒŞ·Ãl.h
"

10 
	~"d©awidg‘.h
"

11 
	~"¡ud’t.h
"

13 
Çme¥aû
 
	gUi
 {

14 
şass
 
	gHutCl›Á
;

17 şas 
	cHutCl›Á
 : 
public
 
QMašWšdow


19 
Q_OBJECT


21 
public
:

22 
ex¶ic™
 
HutCl›Á
(
QWidg‘
 *
·»Á
 = 0);

23 ~
HutCl›Á
();

24 
š™MašWidg‘
();

25 
š™MašAùiÚ
();

26 
š™CÚÃùiÚ
();

28 
	mpublic
:

29 
CÚŒŞPª–
 *
cÚŒŞPª–
;

30 
D©aWidg‘
 *
	md©aWidg‘
;

31 
QDockWidg‘
 *
	mdock
;

32 
Stud’t
 *
	m¡u
;

33 
LogšDlg
 *
	mlogš
;

35 
´iv©e
 
	m¦Ùs
:

36 
ÿÎCÚŒŞPª–
();

37 
ÏunchStud’t
();

38 
£tLab–Stus
(
QSŒšg
 &
¡r
);

39 
showAuthÜMsg
();

41 
	m´iv©e
:

42 
Ui
::
HutCl›Á
 *
ui
;

43 
QLab–
 *
	mÏb–
;

44 
QAùiÚ
 *
	maddTabËRow
, *
	msubTabËRow
;

	@logindlg.cpp

1 
	~"logšdlg.h
"

2 
	~"ui_logšdlg.h
"

4 
	gLogšDlg
::
	$LogšDlg
(
QWidg‘
 *
·»Á
) :

5 
	`QDŸlog
(
·»Á
),

6 
	`ui
(
Ãw
 
Ui
::
LogšDlg
)

8 
ui
->
	`£tupUi
(
this
);

9 
this
->
	`£tWšdowT™Ë
(
	`Œ
("´óÑ§ÉúËØÖÊÍØÕ¹¹ÜÀíÏµÍ³"));

10 
this
->
	`£tWšdowIcÚ
(
	`QIcÚ
(":/images/hutIcon.ico"));

11 
	`š™SigÇlAndSlÙ
();

12 
	`š™Background
();

13 
	}
}

15 
	gLogšDlg
::
	$š™Background
()

17 
QP®‘‹
 
·l
 = 
this
->
	`·Ë‰e
();

18 
QSŒšg
 
f’ame
 = "./login.jpg";

19 
QPixm­
 
	`pixm­
(
f’ame
);

20 
·l
.
	`£tBrush
(
QP®‘‹
::
Wšdow
,
	`QBrush
(
pixm­
));

21 
	`£tP®‘‹
(
·l
);

22 
	}
}

24 
QSŒšg
 
	gLogšDlg
::
	$š™Sql
()

26 
QSŒšg
 
sql
;

28 
sql
 = "CREATE DATABASE IF NOT EXISTS `hut_stu_mge`;";

29 
sql
 += "CREATE TABLE IF NOT EXISTS `hut_stu_mge`.`student` (";

30 
sql
 += " `certificateNum` VARCHAR(20) NOT NULL ,";

31 
sql
 += " `stuId` VARCHAR(15) NOT NULL ,";

32 
sql
 += " `name` VARCHAR(20) NOT NULL ,";

33 
sql
 += " `sex` VARCHAR(10) NOT NULL ,";

34 
sql
 += " `ethnic` VARCHAR(20) NOT NULL ,";

35 
sql
 += " `birthdate` VARCHAR(30) NOT NULL ,";

36 
sql
 += " `birthplace` VARCHAR(150) NOT NULL ,";

37 
sql
 += " `politicalStus` VARCHAR(45) NOT NULL ,";

38 
sql
 += " `school` VARCHAR(45) NOT NULL ,";

39 
sql
 += " `college` VARCHAR(45) NOT NULL ,";

40 
sql
 += " `major` VARCHAR(45) NOT NULL ,";

41 
sql
 += " `entryTime` VARCHAR(45) NOT NULL ,";

42 
sql
 += " `graduateStus` VARCHAR(45) NOT NULL ,";

43 
sql
 += " `semesterOne` INT NOT NULL DEFAULT 0 ,";

44 
sql
 += " `semesterTwo` INT NOT NULL DEFAULT 0 ,";

45 
sql
 += " `semesterThree` INT NOT NULL DEFAULT 0 ,";

46 
sql
 += " `semesterFour` INT NOT NULL DEFAULT 0 ,";

47 
sql
 += " `semesterFive` INT NOT NULL DEFAULT 0 ,";

48 
sql
 += " `semesterSix` INT NOT NULL DEFAULT 0 ,";

49 
sql
 += " `semesterSeven` INT NOT NULL DEFAULT 0 ,";

50 
sql
 += " `semesterEight` INT NOT NULL DEFAULT 0 ,";

51 
sql
 += " `semesterNine` INT NOT NULL DEFAULT 0 ,";

52 
sql
 += " `semesterTen` INT NOT NULL DEFAULT 0 ,";

53 
sql
 += " `totalMark` INT NOT NULL DEFAULT 0 ,";

54 
sql
 += " `remark` VARCHAR(1000) NULL ,";

55 
sql
 += " `certified` INT NOT NULL DEFAULT 0 ,";

56 
sql
 += " PRIMARY KEY (`certificateNum`, `stuId`) ,";

57 
sql
 += " UNIQUE INDEX `certificateNum_UNIQUE` (`certificateNum` ASC) ,";

58 
sql
 += " INDEX `college` (`college` ASC) ,";

59 
sql
 += " UNIQUE INDEX `stuId_UNIQUE` (`stuId` ASC) )";

60 
sql
 += "ENGINE = InnoDB ";

61 
sql
 += "DEFAULT CHARACTER SET = utf8 ";

62 
sql
 += "COLLATE = utf8_general_ci;";

64 
QSqlD©aba£
 
db
 = QSqlD©aba£::
	`addD©aba£
("QMYSQL");

65 
db
.
	`£tHo¡Name
(
this
->
	`g‘Ho¡
());

66 
db
.
	`£tPÜt
(
this
->
	`g‘Ho¡PÜt
());

67 
QSqlQu”y
 
	`que
(
sql
, 
db
);

68 ià(
db
.
	`İ’
(
this
->
u¤
,his->
pwd
))

70 ià(!
que
.
	`exec
())

72 
QMes§geBox
::
	`w¬nšg
(
this
, "¾¯¸æ!",

73 
	`Œ
("³õÊ¼»¯Êı¿âÊ§°Ü, ÏµÍ³½«ÍË³ö!"), 
QMes§geBox
::
Yes
, QMes§geBox::
No
);

74 
	`ex™
(-1);

77 
	`qDebug
(è<< 
sql
;

78  
sql
;

79 
	}
}

82 
QSŒšgLi¡
 
	gLogšDlg
::
	$g‘LškMsg
()

84  
lškMsg
;

85 
	}
}

88 
	gLogšDlg
::
	$£tLškMsg
(cÚ¡ 
QSŒšgLi¡
 &
tmpMsg
)

90 
lškMsg
 = 
tmpMsg
;

91 
	}
}

93 
QSqlD©aba£
 
	gLogšDlg
::
	$lškDb
(cÚ¡ 
QSŒšg
 &
driv”
, cÚ¡ QSŒšg &
dbName
,

94 cÚ¡ 
QSŒšg
 &
ho¡
, cÚ¡ QSŒšg &
u£r
, cÚ¡ QSŒšg &
·sswd
, 
pÜt
)

96 
QSqlE¼Ü
 
”r
;

97 
QSqlD©aba£
 
db
 = QSqlD©aba£::
	`addD©aba£
(
driv”
);

98 
db
.
	`£tHo¡Name
(
ho¡
);

99 
db
.
	`£tD©aba£Name
(
dbName
);

100 
db
.
	`£tPÜt
(
pÜt
);

101 ià(!
db
.
	`İ’
(
u£r
, 
·sswd
è|| u£¸!ğ
	`Œ
("root"))

103 
”r
 = 
db
.
	`Ï¡E¼Ü
();

104 
QMes§geBox
::
	`w¬nšg
(
this
, 
	`Œ
("¾¯¸æ"),

105 "Á¬½ÓMySql³ö´í, ÇëÈ·±£MySqlÒÑÆô¶¯ÇÒÓÃ»§ÃûºÍÃÜÎŞÎó!", 
QMes§geBox
::
Ok
);

106 ià(
db
.
	`isO³n
())

108 
db
.
	`şo£
();

112  
db
;

113 
	}
}

116 
	gLogšDlg
::
	$š™SigÇlAndSlÙ
()

118 
	`cÚÃù
(
ui
->
okBŠ
, 
	`SIGNAL
(
	`şicked
()),

119 
this
, 
	`SLOT
(
	`ÚOkBŠClicked
()));

120 
	`cÚÃù
(
ui
->
ÿnûlBŠ
, 
	`SIGNAL
(
	`şicked
()),

121 
this
, 
	`SLOT
(
	`ÚCªûlBŠClicked
()));

122 
	}
}

125 
	gLogšDlg
::
	$ÚOkBŠClicked
()

127 
QSqlE¼Ü
 
”r
;

128 
QSqlD©aba£
 
db
;

129 
QSŒšgLi¡
 
¡rLi¡
;

130 
QSŒšg
 
¡r
;

131 
tmpPÜt
, 
šdex
;

132 
u¤
 = 
	`u£rName
();

133 
pwd
 = 
	`·sswÜd
();

135 
	`š™CÚnInfo
();

136 
	`š™Sql
();

138 
”r
 = 
	`addCÚÃùiÚ
(
driv”
, 
dbName
, 
ho¡
, 
u¤
, 
pwd
, 
pÜt
);

139 
db
 = 
	`lškDb
(
driv”
, 
dbName
, 
ho¡
, 
u¤
, 
pwd
, 
pÜt
);

140 ià(
”r
.
	`ty³
(è=ğ
QSqlE¼Ü
::
NoE¼Ü
)

143 
¡rLi¡
 << 
	`g‘DbDriv”
();

144 
¡rLi¡
 << 
	`g‘DbName
();

145 
¡rLi¡
 << 
	`g‘Ho¡
();

146 
¡rLi¡
 << 
	`g‘DbU£r
();

147 
¡rLi¡
 << 
	`g‘DbPwd
();

150 
¡r
 = "";

151 
tmpPÜt
 = 
	`g‘Ho¡PÜt
();

152 
	`qDebug
(è<< "¶Ë¿Ú:" << 
tmpPÜt
;

153 ià(
tmpPÜt
 == 0)

155 
¡r
 = str + '0';

157 
tmpPÜt
)

159 
šdex
 = 
tmpPÜt
 % 10;

160 
tmpPÜt
 /= 10;

161 
¡r
 = (
šdex
 + '0') + str;

164 
¡rLi¡
 << 
¡r
;

165 
this
->
	`£tLškMsg
(
¡rLi¡
);

166 
	`qDebug
(è<< "lšk msg ha b“À£t!" << 
¡rLi¡
;

168 
this
->
	`acû±
();

172 
this
->
	`»jeù
();

175 
db
.
	`şo£
();

176 
	}
}

179 
	gLogšDlg
::
	$š™CÚnInfo
()

181 
driv”
 = "QMYSQL";

182 
dbName
 = "hut_stu_mge";

183 
ho¡
 = "127.0.0.1";

184 
pÜt
 = 3306;

185 
	}
}

188 
QSŒšg
 
	gLogšDlg
::
	$u£rName
() const

190  
ui
->
u£LšeEd™
->
	`‹xt
();

191 
	}
}

194 
QSŒšg
 
	gLogšDlg
::
	$·sswÜd
() const

196  
ui
->
pwdLšeEd™
->
	`‹xt
();

197 
	}
}

200 
QSqlE¼Ü
 
	gLogšDlg
::
	$addCÚÃùiÚ
(cÚ¡ 
QSŒšg
 &
driv”
, cÚ¡ QSŒšg &
dbName
,

201 cÚ¡ 
QSŒšg
 &
ho¡
, cÚ¡ QSŒšg &
u£r
, cÚ¡ QSŒšg &
·sswd
, 
pÜt
)

203 
cÚCÁ
 = 0;

204 
QSqlE¼Ü
 
”r
;

206 
QSqlD©aba£
 
db
 = QSqlD©aba£::
	`addD©aba£
(
driv”
, 
	`QSŒšg
("cÚn%1").
	`¬g
(++
cÚCÁ
));

207 
db
.
	`£tHo¡Name
(
ho¡
);

208 
db
.
	`£tD©aba£Name
(
dbName
);

209 
db
.
	`£tPÜt
(
pÜt
);

210 ià(!
db
.
	`İ’
(
u£r
, 
·sswd
) || user != "root")

212 
”r
 = 
db
.
	`Ï¡E¼Ü
();

213 
QSqlD©aba£
::
	`»moveD©aba£
(
	`QSŒšg
("cÚn%1").
	`¬g
(
cÚCÁ
));

216  
”r
;

217 
	}
}

219 
QSŒšg
 
	gLogšDlg
::
	$g‘DbDriv”
() const

221  
driv”
;

222 
	}
}

224 
QSŒšg
 
	gLogšDlg
::
	$g‘Ho¡
() const

226  
ho¡
;

227 
	}
}

229 
	gLogšDlg
::
	$g‘Ho¡PÜt
() const

231  
pÜt
;

232 
	}
}

234 
QSŒšg
 
	gLogšDlg
::
	$g‘DbName
() const

236  
dbName
;

237 
	}
}

239 
QSŒšg
 
	gLogšDlg
::
	$g‘DbU£r
() const

241  
u¤
;

242 
	}
}

244 
QSŒšg
 
	gLogšDlg
::
	$g‘DbPwd
() const

246  
pwd
;

247 
	}
}

249 
	gLogšDlg
::~
	$LogšDlg
()

251 
d–‘e
 
ui
;

252 
	`qDebug
() << "Ã»µÇÂ½³É¹¦, LoginDlgÄÚ´æ±»ÊÍ·Å";

253 
	}
}

	@logindlg.h

1 #iâdeà
LOGINDLG_H


2 
	#LOGINDLG_H


	)

4 
	~<QDŸlog
>

5 
	~<QMes§geBox
>

6 
	~<QDebug
>

7 
	~<QtSql
>

8 
	~<QtGui
>

9 
	~<QMes§geBox
>

10 
	~<QDebug
>

11 
	~<QSqlE¼Ü
>

13 
Çme¥aû
 
	gUi
 {

14 
şass
 
	gLogšDlg
;

17 şas 
	cLogšDlg
 : 
public
 
QDŸlog


19 
Q_OBJECT


21 
public
:

22 
ex¶ic™
 
LogšDlg
(
QWidg‘
 *
·»Á
 = 0);

23 ~
LogšDlg
();

24 
QSŒšg
 
	$u£rName
() const;

25 
QSŒšg
 
	$·sswÜd
() const;

26 
QSqlE¼Ü
 
	`addCÚÃùiÚ
(cÚ¡ 
QSŒšg
 &
driv”
, cÚ¡ QSŒšg &
dbName
, cÚ¡ QSŒšg &
ho¡
,

27 cÚ¡ 
QSŒšg
 &
u£r
, cÚ¡ QSŒšg &
·sswd
, 
pÜt
 = 3306);

28 
	`š™CÚnInfo
();

29 
	`š™SigÇlAndSlÙ
();

30 
QSqlD©aba£
 
	`lškDb
(cÚ¡ 
QSŒšg
 &
driv”
, cÚ¡ QSŒšg &
dbName
, cÚ¡ QSŒšg &
ho¡
,

31 cÚ¡ 
QSŒšg
 &
u£r
, cÚ¡ QSŒšg &
·sswd
, 
pÜt
 = 3306);

32 
QSŒšg
 
	$g‘DbU£r
() const;

33 
QSŒšg
 
	$g‘DbPwd
() const;

34 
QSŒšg
 
	$g‘DbDriv”
() const;

35 
QSŒšg
 
	$g‘DbName
() const;

36 
QSŒšg
 
	$g‘Ho¡
() const;

37 
	$g‘Ho¡PÜt
() const;

38 
	`£tLškMsg
(cÚ¡ 
QSŒšgLi¡
 &
tmpMsg
);

39 
QSŒšgLi¡
 
	`g‘LškMsg
();

40 
QSŒšg
 
	`š™Sql
();

41 
	`š™Background
();

43 
public
:

44 
QSŒšg
 
u¤
, 
pwd
, 
driv”
, 
dbName
, 
ho¡
;

45 
pÜt
;

47 
´iv©e
 
¦Ùs
:

48 
	`ÚOkBŠClicked
();

49 
	$ÚCªûlBŠClicked
()

51 
	`»jeù
();

54 
´iv©e
:

55 
Ui
::
LogšDlg
 *
ui
;

56 
QSŒšgLi¡
 
lškMsg
;

57 
	}
};

	@main.cpp

1 
	~<QtGui/QAµliÿtiÚ
>

2 
	~<QTextCodec
>

3 
	~"hutş›Á.h
"

5 
	$maš
(
¬gc
, *
¬gv
[])

7 
QAµliÿtiÚ
 
	`­p
(
¬gc
, 
¬gv
);

8 
	`Q_INIT_RESOURCE
(
Image
);

9 
a
.
	`£tWšdowIcÚ
(
	`QIcÚ
(":/resourse/hutIcon.ico"));

10 
QTextCodec
::
	`£tCodecFÜCSŒšgs
(QTextCodec::
	`codecFÜName
("GBK"));

11 
QTextCodec
::
	`£tCodecFÜCSŒšgs
(QTextCodec::
	`codecFÜName
("GBK"));

12 
QTextCodec
::
	`£tCodecFÜTr
(QTextCodec::
	`codecFÜName
("GBK"));

13 
HutCl›Á
 
ş›Á
;

14 
ş›Á
.
	`show
();

16  
­p
.
	`exec
();

17 
	}
}

	@student.cpp

1 
	~<QDebug
>

2 
	~"¡ud’t.h
"

3 
	~"ui_¡ud’t.h
"

5 
	gStud’t
::
	$Stud’t
(
QWidg‘
 *
·»Á
) :

6 
	`QDŸlog
(
·»Á
),

7 
	`ui
(
Ãw
 
Ui
::
Stud’t
)

9 
ui
->
	`£tupUi
(
this
);

10 
	`š™MašWidg‘
();

11 
	`š™DeçuÉD©a
();

12 
	`š™CÚÃùiÚ
();

13 
this
->
	`£tVisibË
(
çl£
);

14 
	}
}

16 
	gStud’t
::
	$š™DeçuÉD©a
()

18 
ui
->
£xComBo
->
	`addI‹m
(
	`Œ
("ÄĞ"));

19 
ui
->
£xComBo
->
	`addI‹m
(
	`Œ
("Å®"));

20 
ui
->
g¿du©eTy³CB
->
	`addI‹m
("±¾¿ÆÉú");

21 
ui
->
g¿du©eTy³CB
->
	`addI‹m
("×¨¿ÆÉú");

22 
ui
->
schoŞLE
->
	`£tText
(
	`Œ
("ºşÄÏ¹¤Òµ´óÑ§"));

23 
ui
->
£me¡”OÃ
->
	`£tText
(
	`Œ
("0"));

24 
ui
->
£me¡”Two
->
	`£tText
(
	`Œ
("0"));

25 
ui
->
£me¡”Two
->
	`£tText
(
	`Œ
("0"));

26 
ui
->
£me¡”Th»e
->
	`£tText
(
	`Œ
("0"));

27 
ui
->
£me¡”Four
->
	`£tText
(
	`Œ
("0"));

28 
ui
->
£me¡”Five
->
	`£tText
(
	`Œ
("0"));

29 
ui
->
£me¡”Six
->
	`£tText
(
	`Œ
("0"));

30 
ui
->
£me¡”Sev’
->
	`£tText
(
	`Œ
("0"));

31 
ui
->
£me¡”Eight
->
	`£tText
(
	`Œ
("0"));

32 
ui
->
£me¡”Nše
->
	`£tText
(
	`Œ
("0"));

33 
ui
->
£me¡”T’
->
	`£tText
(
	`Œ
("0"));

34 
ui
->
»m¬kTE
->
	`£tText
(
	`Œ
("ÎŞ"));

35 
	}
}

37 
	gStud’t
::
	$š™CÚÃùiÚ
()

39 
	`cÚÃù
(
ui
->
cÚfœeAddStu
, 
	`SIGNAL
(
	`şicked
()),

40 
this
, 
	`SLOT
(
	`g‘StuInfo
()));

41 
	`cÚÃù
(
ui
->
ÿnûlAddStu
, 
	`SIGNAL
(
	`şicked
()),

42 
this
, 
	`SLOT
(
	`şo£
()));

43 
	}
}

46 
	gStud’t
::
	$g‘StuInfo
()

48 
Ën
;

49 
QRegExp
 
	`»g
("^\\d+$");

51 
û¹ifiÿ‹Num
 = 
ui
->
û¹if›dNumLE
->
	`‹xt
();

52 
¡uId
 = 
ui
->
¡uIdLE
->
	`‹xt
();

53 
Çme
 = 
ui
->
¡uNameLE
->
	`‹xt
();

54 
£x
 = 
ui
->
£xComBo
->
	`cu¼’tText
();

55 
‘hnic
 = 
ui
->
‘hnicLE
->
	`‹xt
();

56 
bœthD©e
 = 
ui
->
bœthD©eLE
->
	`‹xt
();

57 
bœthPÏû
 = 
ui
->
bœthPÏûLE
->
	`‹xt
();

58 
pŞ™iStu
 = 
ui
->
pŞ™iÿlStuLE
->
	`‹xt
();

59 
schoŞ
 = 
ui
->
schoŞLE
->
	`‹xt
();

60 
cŞËge
 = 
ui
->
cŞËgeLE
->
	`‹xt
();

61 
majÜ
 = 
ui
->
majÜLE
->
	`‹xt
();

62 
’ŒyD©e
 = 
ui
->
’ŒyTimeLE
->
	`‹xt
();

63 
g¿du©eTy³
 = 
ui
->
g¿du©eTy³CB
->
	`cu¼’tText
();

64 
»m¬k
 = 
ui
->
»m¬kTE
->
	`toPÏšText
();

66 
Ën
 = 0;

67 ià(
»g
.
	`exaùM©ch
(
ui
->
£me¡”OÃ
->
	`‹xt
()))

69 
m¬k
[
Ën
++] = 
ui
->
£me¡”OÃ
->
	`‹xt
().
	`toIÁ
();

72 ià(
»g
.
	`exaùM©ch
(
ui
->
£me¡”Two
->
	`‹xt
()))

74 
m¬k
[
Ën
++] = 
ui
->
£me¡”Two
->
	`‹xt
().
	`toIÁ
();

77 ià(
»g
.
	`exaùM©ch
(
ui
->
£me¡”Th»e
->
	`‹xt
()))

79 
m¬k
[
Ën
++] = 
ui
->
£me¡”Th»e
->
	`‹xt
().
	`toIÁ
();

82 ià(
»g
.
	`exaùM©ch
(
ui
->
£me¡”Four
->
	`‹xt
()))

84 
m¬k
[
Ën
++] = 
ui
->
£me¡”Four
->
	`‹xt
().
	`toIÁ
();

87 ià(
»g
.
	`exaùM©ch
(
ui
->
£me¡”Five
->
	`‹xt
()))

89 
m¬k
[
Ën
++] = 
ui
->
£me¡”Five
->
	`‹xt
().
	`toIÁ
();

92 ià(
»g
.
	`exaùM©ch
(
ui
->
£me¡”Six
->
	`‹xt
()))

94 
m¬k
[
Ën
++] = 
ui
->
£me¡”Six
->
	`‹xt
().
	`toIÁ
();

97 ià(
»g
.
	`exaùM©ch
(
ui
->
£me¡”Sev’
->
	`‹xt
()))

99 
m¬k
[
Ën
++] = 
ui
->
£me¡”Sev’
->
	`‹xt
().
	`toIÁ
();

102 ià(
»g
.
	`exaùM©ch
(
ui
->
£me¡”Eight
->
	`‹xt
()))

104 
m¬k
[
Ën
++] = 
ui
->
£me¡”Eight
->
	`‹xt
().
	`toIÁ
();

107 ià(
»g
.
	`exaùM©ch
(
ui
->
£me¡”Nše
->
	`‹xt
()))

109 
m¬k
[
Ën
++] = 
ui
->
£me¡”Nše
->
	`‹xt
().
	`toIÁ
();

112 ià(
»g
.
	`exaùM©ch
(
ui
->
£me¡”T’
->
	`‹xt
()))

114 
m¬k
[
Ën
++] = 
ui
->
£me¡”T’
->
	`‹xt
().
	`toIÁ
();

117 ià(
Ën
 !ğ
STU_MARK_CNT
)

119 
QMes§geBox
::
	`w¬nšg
(
this
, 
	`Œ
("¾¯¸æ:"),

120 
	`Œ
("ËùÌîÊı¾İ²»ºÏ·¨, Çë¼ì²é¸üÕı!"), 
QMes§geBox
::
Yes
, QMes§geBox::
No
);

123 
	`qDebug
(è<< 
Ën
;

125 
	`š£¹D©a
();

126 
	}
}

129 
	gStud’t
::
	$š£¹D©a
()

131 
QSŒšgLi¡
 
¡rLi¡
;

132 
QSŒšg
 
¡r
, 
¡rLab–
;

133 
QMes§geBox
 
šfo
;

134 
i
, 
Ën
, 
sum
;

136 
¡rLi¡
 << 
û¹ifiÿ‹Num
;

137 
¡rLi¡
 << 
¡uId
;

138 
¡rLi¡
 << 
Çme
;

139 
¡rLi¡
 << 
£x
;

140 
¡rLi¡
 << 
‘hnic
;

141 
¡rLi¡
 << 
bœthD©e
;

142 
¡rLi¡
 << 
bœthPÏû
;

143 
¡rLi¡
 << 
pŞ™iStu
;

144 
¡rLi¡
 << 
schoŞ
;

145 
¡rLi¡
 << 
cŞËge
;

146 
¡rLi¡
 << 
majÜ
;

147 
¡rLi¡
 << 
’ŒyD©e
;

148 
¡rLi¡
 << 
g¿du©eTy³
;

149 
¡rLi¡
 << 
ui
->
£me¡”OÃ
->
	`‹xt
();

150 
¡rLi¡
 << 
ui
->
£me¡”Two
->
	`‹xt
();

151 
¡rLi¡
 << 
ui
->
£me¡”Th»e
->
	`‹xt
();

152 
¡rLi¡
 << 
ui
->
£me¡”Four
->
	`‹xt
();

153 
¡rLi¡
 << 
ui
->
£me¡”Five
->
	`‹xt
();

154 
¡rLi¡
 << 
ui
->
£me¡”Six
->
	`‹xt
();

155 
¡rLi¡
 << 
ui
->
£me¡”Sev’
->
	`‹xt
();

156 
¡rLi¡
 << 
ui
->
£me¡”Eight
->
	`‹xt
();

157 
¡rLi¡
 << 
ui
->
£me¡”Nše
->
	`‹xt
();

158 
¡rLi¡
 << 
ui
->
£me¡”T’
->
	`‹xt
();

160 
Ën
 = 
STU_MARK_CNT
;

161 
sum
 = 0;

162 
i
 = 0; i < 
Ën
; ++i)

164 
sum
 +ğ
m¬k
[
i
];

167 
¡r
 = "";

168 
sum
)

170 
i
 = 
sum
 % 10;

171 
sum
 /= 10;

172 
¡r
 = (
i
 + '0') + str;

174 ià(
¡r
 == "")

176 
¡r
 += '0';

178 
¡rLi¡
 << 
¡r
;

179 
¡rLi¡
 << 
ui
->
»m¬kTE
->
	`toPÏšText
();

180 
¡rLi¡
 << "·ñ";

182 
šfo
.
	`£tText
(
	`Œ
("ÊÇ·ñÈ·ÈÏÌí¼ÓÑ§ÉúĞÅÏ¢?"));

183 
šfo
.
	`£tSnd¬dBu‰Ús
(
QMes§geBox
::
Yes
 | QMes§geBox::
No
);

184 
šfo
.
	`£tWšdowT™Ë
(
	`Œ
("ÌáÊ¾:"));

185 
šfo
.
	`£tWšdowIcÚ
(
	`QIcÚ
(":/images/hutIcon.ico"));

186 ià(
šfo
.
	`exec
(è!ğ
QMes§geBox
::
Yes
)

188 
this
->
	`şo£
();

189 
this
->
	`hide
();

193 
em™
 
	`subm™Stu
(
¡rLi¡
);

194 
¡rLab–
 = "Ñ§Éú ";

195 
¡rLab–
 +ğ
Çme
;

196 
¡rLab–
 += " ÒÑÌí¼Óµ½±í¸ñÖĞ!";

197 
em™
 
this
->
	`£ndTextFÜLab–
(
¡rLab–
);

198 
	`qDebug
(è<< 
this
->
	`isHidd’
();

199 
	`ş—rD©a
();

200 
	`qDebug
() << "ÒÑ·¢ËÍÒ»ÌõĞÅÏ¢µ½DataWidget!";

202 
	}
}

204 
	gStud’t
::
	$š™MašWidg‘
()

206 
	`»size
(630, 460);

207 
	`£tMaximumSize
(630, 460);

208 
	`£tMšimumSize
(630, 460);

209 
	`£tWšdowT™Ë
(
	`Œ
("Ìí¼ÓÑ§Éú"));

210 
	`£tWšdowIcÚ
(
	`QIcÚ
(":/images/hutIcon.ico"));

211 
	`£tVisibË
(
Œue
);

212 
	}
}

214 
	gStud’t
::
	$ş—rD©a
()

216 
ui
->
û¹if›dNumLE
->
	`£tText
(
	`Œ
(""));

217 
ui
->
¡uIdLE
->
	`£tText
(
	`Œ
(""));

218 
ui
->
¡uNameLE
->
	`£tText
(
	`Œ
(""));

219 
ui
->
‘hnicLE
->
	`£tText
(
	`Œ
(""));

220 
ui
->
bœthD©eLE
->
	`£tText
(
	`Œ
(""));

221 
ui
->
bœthPÏûLE
->
	`£tText
(
	`Œ
(""));

222 
ui
->
pŞ™iÿlStuLE
->
	`£tText
(
	`Œ
(""));

223 
ui
->
cŞËgeLE
->
	`£tText
(
	`Œ
(""));

224 
ui
->
majÜLE
->
	`£tText
(
	`Œ
(""));

225 
ui
->
’ŒyTimeLE
->
	`£tText
(
	`Œ
(""));

226 
ui
->
»m¬kTE
->
	`£tText
(
	`Œ
("ÎŞ"));

227 
ui
->
£me¡”OÃ
->
	`£tText
(
	`Œ
("0"));

228 
ui
->
£me¡”Two
->
	`£tText
(
	`Œ
("0"));

229 
ui
->
£me¡”Th»e
->
	`£tText
(
	`Œ
("0"));

230 
ui
->
£me¡”Four
->
	`£tText
(
	`Œ
("0"));

231 
ui
->
£me¡”Five
->
	`£tText
(
	`Œ
("0"));

232 
ui
->
£me¡”Six
->
	`£tText
(
	`Œ
("0"));

233 
ui
->
£me¡”Sev’
->
	`£tText
(
	`Œ
("0"));

234 
ui
->
£me¡”Eight
->
	`£tText
(
	`Œ
("0"));

235 
ui
->
£me¡”Nše
->
	`£tText
(
	`Œ
("0"));

236 
ui
->
£me¡”T’
->
	`£tText
(
	`Œ
("0"));

237 
	}
}

239 
	gStud’t
::
	$keyP»ssEv’t
(
QKeyEv’t
 *
ev’t
)

241 
keyCode
 = 
ev’t
->
	`key
();

243 ià(
keyCode
 =ğ
Qt
::
Key_EÁ”
)

245 
	`g‘StuInfo
();

247 
	}
}

249 
	gStud’t
::~
	$Stud’t
()

251 
d–‘e
 
ui
;

252 
	}
}

	@student.h

1 #iâdeà
STUDENT_H


2 
	#STUDENT_H


	)

4 
	~<QDŸlog
>

5 
	~<QWidg‘
>

6 
	~<QSizePŞicy
>

7 
	~<QMes§geBox
>

8 
	~<QRegExp
>

9 
	~<QDebug
>

10 
	~<QIcÚ
>

11 
	~<QKeyEv’t
>

12 
	#STU_MARK_CNT
 10

	)

14 
Çme¥aû
 
	gUi
 {

15 
şass
 
	gStud’t
;

18 şas 
	cStud’t
 : 
public
 
QDŸlog


20 
Q_OBJECT


22 
public
:

23 
ex¶ic™
 
Stud’t
(
QWidg‘
 *
·»Á
 = 0);

24 ~
Stud’t
();

25 
š™MašWidg‘
();

26 
š™DeçuÉD©a
();

27 
š™CÚÃùiÚ
();

28 
š£¹D©a
();

29 
ş—rD©a
();

31 
	m´Ùeùed
:

32 
vœtu®
 
keyP»ssEv’t
(
QKeyEv’t
 *
ev’t
);

34 
	msigÇls
:

35 
subm™Stu
(
QSŒšgLi¡
 &
¡rLi¡
);

36 
£ndTextFÜLab–
(
QSŒšg
 &
¡r
);

38 
´iv©e
 
	m¦Ùs
:

39 
g‘StuInfo
();

41 
	m´iv©e
:

42 
Ui
::
Stud’t
 *
ui
;

43 
QSŒšg
 
	mû¹ifiÿ‹Num
, 
	m¡uId
, 
	mÇme
, 
	m£x
, 
	m‘hnic
, 
	mbœthD©e
, 
	mbœthPÏû
;

44 
QSŒšg
 
	mpŞ™iStu
, 
	mschoŞ
, 
	mcŞËge
, 
	mmajÜ
, 
	m’ŒyD©e
, 
	mg¿du©eTy³
, 
	m»m¬k
;

45 
	mm¬k
[
STU_MARK_CNT
];

	@
1
.
1
/usr/include
11
141
controlpanel.cpp
controlpanel.h
datawidget.cpp
datawidget.h
hutclient.cpp
hutclient.h
logindlg.cpp
logindlg.h
main.cpp
student.cpp
student.h
